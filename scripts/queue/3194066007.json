{"url":"https://api.github.com/repos/vercel/next.js/issues/81161","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/81161/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/81161/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/81161/events","html_url":"https://github.com/vercel/next.js/issues/81161","id":3194066007,"node_id":"I_kwDOBC3Cis6-YZRX","number":81161,"title":"Turbopack dev server uses too much RAM and CPU","user":{"login":"dokugo","id":7773972,"node_id":"MDQ6VXNlcjc3NzM5NzI=","avatar_url":"https://avatars.githubusercontent.com/u/7773972?v=4","gravatar_id":"","url":"https://api.github.com/users/dokugo","html_url":"https://github.com/dokugo","followers_url":"https://api.github.com/users/dokugo/followers","following_url":"https://api.github.com/users/dokugo/following{/other_user}","gists_url":"https://api.github.com/users/dokugo/gists{/gist_id}","starred_url":"https://api.github.com/users/dokugo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dokugo/subscriptions","organizations_url":"https://api.github.com/users/dokugo/orgs","repos_url":"https://api.github.com/users/dokugo/repos","events_url":"https://api.github.com/users/dokugo/events{/privacy}","received_events_url":"https://api.github.com/users/dokugo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3572357224,"node_id":"LA_kwDOBC3Cis7U7dho","url":"https://api.github.com/repos/vercel/next.js/labels/Performance","name":"Performance","color":"5101E2","default":false,"description":"Anything with regards to Next.js performance."},{"id":4771244046,"node_id":"LA_kwDOBC3Cis8AAAABHGNoDg","url":"https://api.github.com/repos/vercel/next.js/labels/Turbopack","name":"Turbopack","color":"FF1E56","default":false,"description":"Related to Turbopack with Next.js."}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-07-01T23:21:16Z","updated_at":"2025-07-01T23:21:30Z","closed_at":null,"author_association":"NONE","type":{"id":1930995,"node_id":"IT_kwDOAOSnPM4AHXbz","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T15:36:35Z","updated_at":"2024-07-26T10:33:22Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"body":"### Link to the code that reproduces this issue\n\nhttps://github.com/dokugo/next-reown-appkit-memory-usage\n\n### To Reproduce\n\n1. Clone https://github.com/dokugo/next-reown-appkit-memory-usage\n2. Install dependencies\n3. Run dev server with Turbopack: `npm run dev` / `pnpm dev` / etc...\n4. Open http://localhost:3000\n5. Click through navbar links (routes 0 to 14)\n6. Notice that each route compilation causes massive CPU spike and adds ~400 MB to the dev server process\n7. See dev server process eventually taking 8000 MB RAM\n8. Hard reload at any route to add ~30 MB each time, repeatable until hitting OOM\n\n### Current vs. Expected behavior\n\n**Current behavior:**\n\nTurbopack dev server consumes a huge amount of RAM and CPU, even in an almost empty app with 15 blank routes. \n\n- Just running npm run dev and opening localhost leads to ~2000 MB RAM usage\n- After visiting 15 blank routes, the dev server process takes ~8000 MB (vs ~2500 MB with Webpack)\n- Each route compilation adds ~400 MB\n- A high CPU spike for a few seconds while compiling each route\n- Route compilation ~5x slower than with Webpack\n- HMR uses ~5% of CPU instead of the usual 0.1%\n- Hard page reload adds ~30 MB each time, it just keeps growing until OOM\n\n**Expected behavior:**\n\nTurbopack dev server consumes a reasonable amount of RAM and CPU (especially while running an almost empty app).\n\n### Provide environment information\n\n```bash\nOperating System:\n  Platform: win32\n  Arch: x64\n  Version: Windows 11 Pro\n  Available memory (MB): 65144\n  Available CPU cores: 16\nBinaries:\n  Node: 22.16.0\n  npm: 10.9.2\n  Yarn: N/A\n  pnpm: N/A\nRelevant Packages:\n  next: 15.3.4 // Latest available version is detected (15.3.4).\n  eslint-config-next: 15.3.4\n  react: 19.1.0\n  react-dom: 19.1.0\n  typescript: 5.8.3\nNext.js Config:\n  output: N/A\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nTurbopack, Performance\n\n### Which stage(s) are affected? (Select all that apply)\n\nnext dev (local)\n\n### Additional context\n\nI've been setting up a Next.js app, in which I needed to add crypto wallet functionality, so I used one of the most popular solutions, Reown Appkit (previously WalletConnect).\n\nI'm not sure if this issue is specific to Next.js, or if Appkit has some Next-specific quirks that interfere with the Turbopack dev server.\n\nHowever, I was not able to reproduce this behavior with:\n\n- Remix (React Router 7)\n- Tanstack Start\n- CSR React + Vite\n\nAlso tried next@canary, no difference.\n\nTrace and CPU profile:\nhttps://drive.proton.me/urls/RRYXZKSFCR#8l8AlzydcGAw","reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/81161/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/81161/timeline","performed_via_github_app":null,"state_reason":null,"score":1.0}
