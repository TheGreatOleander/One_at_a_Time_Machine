{"url":"https://api.github.com/repos/vercel/next.js/issues/80868","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/80868/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/80868/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/80868/events","html_url":"https://github.com/vercel/next.js/issues/80868","id":3173121539,"node_id":"I_kwDOBC3Cis69If4D","number":80868,"title":"Google not indexing pages due to \"Duplicate without user-selected canonical\" issue","user":{"login":"jperezr21","id":12447726,"node_id":"MDQ6VXNlcjEyNDQ3NzI2","avatar_url":"https://avatars.githubusercontent.com/u/12447726?v=4","gravatar_id":"","url":"https://api.github.com/users/jperezr21","html_url":"https://github.com/jperezr21","followers_url":"https://api.github.com/users/jperezr21/followers","following_url":"https://api.github.com/users/jperezr21/following{/other_user}","gists_url":"https://api.github.com/users/jperezr21/gists{/gist_id}","starred_url":"https://api.github.com/users/jperezr21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jperezr21/subscriptions","organizations_url":"https://api.github.com/users/jperezr21/orgs","repos_url":"https://api.github.com/users/jperezr21/repos","events_url":"https://api.github.com/users/jperezr21/events{/privacy}","received_events_url":"https://api.github.com/users/jperezr21/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3555293326,"node_id":"LA_kwDOBC3Cis7T6XiO","url":"https://api.github.com/repos/vercel/next.js/labels/Metadata","name":"Metadata","color":"CEC038","default":false,"description":"Related to Next.js' Metadata API."}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2025-06-24T19:56:25Z","updated_at":"2025-06-28T17:52:50Z","closed_at":null,"author_association":"NONE","type":{"id":1930995,"node_id":"IT_kwDOAOSnPM4AHXbz","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T15:36:35Z","updated_at":"2024-07-26T10:33:22Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"body":"### Link to the code that reproduces this issue\n\nhttps://github.com/jperezr21/static-and-dynamic-metadata\n\n### To Reproduce\n\n1. Create dynamic path with async `generateMetadata` that sets `alternates.canonical` to the path without any query params (let's say `/[storeHandle]/[productSlug]`).\n2. Have a selectable property that's reflected in the URL query params (eg: `?variant=[variantName]`)\n3. Have other pages link to the page with the query params (eg: link to specific product variants).\n4. Google will say there's no user-selected canonical for these pages even though it is (the problem is that the canonical tag is being streamed and it's not present in the initial HTML).\n\n![Image](https://github.com/user-attachments/assets/d8835f48-50bf-4dce-aba3-ceb05f202283)\n\n![Image](https://github.com/user-attachments/assets/18fd2613-80ab-4294-926d-9f0f664ad25b)\n\n### Current vs. Expected behavior\n\n- Current: Google is not detecting user-selected canonical for streamed pages\n- Expected: Have the ability for defining both static and dynamic metadata. I want to have the canonical as static, but the rest (product title, description, images, etc) dynamic. This isn't supported at the moment (from the docs):\n> You cannot export both the metadata object and generateMetadata function from the same route segment.\n\n### Provide environment information\n\n```bash\nOperating System:\n  Platform: darwin\n  Arch: arm64\n  Version: Darwin Kernel Version 24.5.0: Tue Apr 22 19:54:29 PDT 2025; root:xnu-11417.121.6~2/RELEASE_ARM64_T6030\n  Available memory (MB): 18432\n  Available CPU cores: 11\nBinaries:\n  Node: 22.13.1\n  npm: 11.1.0\n  Yarn: N/A\n  pnpm: 10.12.1\nRelevant Packages:\n  next: 15.3.4 // Latest available version is detected (15.3.4).\n  eslint-config-next: N/A\n  react: 19.1.0\n  react-dom: 19.1.0\n  typescript: N/A\nNext.js Config:\n  output: N/A\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nMetadata\n\n### Which stage(s) are affected? (Select all that apply)\n\nVercel (Deployed)\n\n### Additional context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/80868/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/80868/timeline","performed_via_github_app":null,"state_reason":null,"score":1.0}
