{"url":"https://api.github.com/repos/vercel/next.js/issues/80658","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/80658/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/80658/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/80658/events","html_url":"https://github.com/vercel/next.js/issues/80658","id":3156913936,"node_id":"I_kwDOBC3Cis68Kq8Q","number":80658,"title":"Metadata duplication in <head> when using next-intl middleware with locale redirects","user":{"login":"jjtsou","id":17753005,"node_id":"MDQ6VXNlcjE3NzUzMDA1","avatar_url":"https://avatars.githubusercontent.com/u/17753005?v=4","gravatar_id":"","url":"https://api.github.com/users/jjtsou","html_url":"https://github.com/jjtsou","followers_url":"https://api.github.com/users/jjtsou/followers","following_url":"https://api.github.com/users/jjtsou/following{/other_user}","gists_url":"https://api.github.com/users/jjtsou/gists{/gist_id}","starred_url":"https://api.github.com/users/jjtsou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjtsou/subscriptions","organizations_url":"https://api.github.com/users/jjtsou/orgs","repos_url":"https://api.github.com/users/jjtsou/repos","events_url":"https://api.github.com/users/jjtsou/events{/privacy}","received_events_url":"https://api.github.com/users/jjtsou/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3499418124,"node_id":"LA_kwDOBC3Cis7QlOIM","url":"https://api.github.com/repos/vercel/next.js/labels/Middleware","name":"Middleware","color":"3116D4","default":false,"description":"Related to Next.js Middleware."},{"id":3555293326,"node_id":"LA_kwDOBC3Cis7T6XiO","url":"https://api.github.com/repos/vercel/next.js/labels/Metadata","name":"Metadata","color":"CEC038","default":false,"description":"Related to Next.js' Metadata API."},{"id":8074089548,"node_id":"LA_kwDOBC3Cis8AAAAB4UDUTA","url":"https://api.github.com/repos/vercel/next.js/labels/Redirects","name":"Redirects","color":"e99695","default":false,"description":"Related to redirecting."}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-06-18T13:32:59Z","updated_at":"2025-06-21T19:13:19Z","closed_at":null,"author_association":"NONE","type":{"id":1930995,"node_id":"IT_kwDOAOSnPM4AHXbz","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T15:36:35Z","updated_at":"2024-07-26T10:33:22Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"body":"### Link to the code that reproduces this issue\n\nhttps://github.com/jjtsou/job-board\n\n### To Reproduce\n\n**To Reproduce**\n\n1. Set up next-intl middleware for internationalization.\n2. Configure locale routing with redirects from / to /[locale].\n3. Export a generateMetadata function in a page component.\n4. Navigate from / to a locale path (e.g., /en).\n5. Inspect the HTML output in browser DevTools.\n\n**Example code**\n\n```typescript\n// middleware.ts\nimport createMiddleware from 'next-intl/middleware';\nimport { routing } from './src/i18n/routing';\n\nexport default createMiddleware(routing);\n\nexport const config = {\n  matcher: ['/', '/(en|el)/:path*']\n};\n```\n\n```typescript\n// src/i18n/routing.ts\nexport const routing = {\n  locales: ['en', 'el'],\n  defaultLocale: 'en',\n  localePrefixMode: 'always'\n} as const;\n```\n\n```typescript\n// app/[locale]/page.tsx\nexport async function generateMetadata({\n  params,\n  searchParams,\n}: Props): Promise<Metadata> {\n  const { locale } = await params;\n  const t = await getTranslations({ locale, namespace: \"meta\" });\n\n  return {\n    title: t('title'),\n    description: t('description'),\n    openGraph: {\n      title: t('title'),\n      description: t('description'),\n      type: \"website\",\n      locale,\n    },\n  };\n}\n```\n\n### Current vs. Expected behavior\n\nFollowing the steps from the previous section, I expected the metadata to appear only once in the <head> section when redirecting between routes. However, metadata tags (title, description, Open Graph, etc.) are duplicated in the HTML output after locale redirects.\n\n<!-- Expected: Single metadata -->\n```html\n<head>\n  <title>Job Board</title>\n  <meta name=\"description\" content=\"Find jobs...\" />\n</head>\n```\n\n<!-- Actual: Duplicated metadata -->\n```html\n<head>\n  <title>Job Board</title>\n  <title>Job Board</title>\n  <meta name=\"description\" content=\"Find jobs...\" />\n  <meta name=\"description\" content=\"Find jobs...\" />\n</head>\n```\n\n### Provide environment information\n\n```bash\nOperating System:\nPlatform: darwin\nArch: arm64\nVersion: Darwin Kernel Version 24.4.0\n\nBinaries:\nNode: 21.6.2\nnpm: 10.2.4\nYarn: N/A\npnpm: N/A\n\nRelevant Packages:\nnext: 15.3.2\neslint-config-next: N/A\nreact: 19.1.0\nreact-dom: 19.1.0\ntypescript: 5.8.3\nnext-intl: 4.1.0\n\nNext.js Config:\noutput: N/A\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nMetadata, Middleware, Redirects\n\n### Which stage(s) are affected? (Select all that apply)\n\nVercel (Deployed)\n\n### Additional context\n\nAdditional context\n\n- Issue does NOT occur with static metadata exports.\n- Only happens with generateMetadata function during locale redirects.\n- Metadata merging behavior seems inconsistent with documented behavior.\n- The issue is reproducible on deployed (Vercel) environments.","reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/80658/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/80658/timeline","performed_via_github_app":null,"state_reason":null,"score":1.0}
