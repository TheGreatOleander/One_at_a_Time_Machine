{"url":"https://api.github.com/repos/vercel/next.js/issues/80879","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/80879/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/80879/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/80879/events","html_url":"https://github.com/vercel/next.js/issues/80879","id":3173673883,"node_id":"I_kwDOBC3Cis69Kmub","number":80879,"title":"Docs: should clarify whether we can call redirect within generateMetadata","user":{"login":"yonran","id":483060,"node_id":"MDQ6VXNlcjQ4MzA2MA==","avatar_url":"https://avatars.githubusercontent.com/u/483060?v=4","gravatar_id":"","url":"https://api.github.com/users/yonran","html_url":"https://github.com/yonran","followers_url":"https://api.github.com/users/yonran/followers","following_url":"https://api.github.com/users/yonran/following{/other_user}","gists_url":"https://api.github.com/users/yonran/gists{/gist_id}","starred_url":"https://api.github.com/users/yonran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yonran/subscriptions","organizations_url":"https://api.github.com/users/yonran/orgs","repos_url":"https://api.github.com/users/yonran/repos","events_url":"https://api.github.com/users/yonran/events{/privacy}","received_events_url":"https://api.github.com/users/yonran/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":8700361796,"node_id":"LA_kwDOBC3Cis8AAAACBpT8RA","url":"https://api.github.com/repos/vercel/next.js/labels/Improvement","name":"Improvement","color":"762318","default":false,"description":"Report possible improvements to make in our documentation"}],"state":"open","locked":false,"assignee":{"login":"icyJoseph","id":21013447,"node_id":"MDQ6VXNlcjIxMDEzNDQ3","avatar_url":"https://avatars.githubusercontent.com/u/21013447?v=4","gravatar_id":"","url":"https://api.github.com/users/icyJoseph","html_url":"https://github.com/icyJoseph","followers_url":"https://api.github.com/users/icyJoseph/followers","following_url":"https://api.github.com/users/icyJoseph/following{/other_user}","gists_url":"https://api.github.com/users/icyJoseph/gists{/gist_id}","starred_url":"https://api.github.com/users/icyJoseph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icyJoseph/subscriptions","organizations_url":"https://api.github.com/users/icyJoseph/orgs","repos_url":"https://api.github.com/users/icyJoseph/repos","events_url":"https://api.github.com/users/icyJoseph/events{/privacy}","received_events_url":"https://api.github.com/users/icyJoseph/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icyJoseph","id":21013447,"node_id":"MDQ6VXNlcjIxMDEzNDQ3","avatar_url":"https://avatars.githubusercontent.com/u/21013447?v=4","gravatar_id":"","url":"https://api.github.com/users/icyJoseph","html_url":"https://github.com/icyJoseph","followers_url":"https://api.github.com/users/icyJoseph/followers","following_url":"https://api.github.com/users/icyJoseph/following{/other_user}","gists_url":"https://api.github.com/users/icyJoseph/gists{/gist_id}","starred_url":"https://api.github.com/users/icyJoseph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icyJoseph/subscriptions","organizations_url":"https://api.github.com/users/icyJoseph/orgs","repos_url":"https://api.github.com/users/icyJoseph/repos","events_url":"https://api.github.com/users/icyJoseph/events{/privacy}","received_events_url":"https://api.github.com/users/icyJoseph/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2025-06-25T00:25:48Z","updated_at":"2025-06-25T17:56:02Z","closed_at":null,"author_association":"NONE","type":{"id":25076157,"node_id":"IT_kwDOAOSnPM4BfqG9","name":"Documentation","description":"An issue related to documentation","color":"orange","created_at":"2025-01-16T18:30:16Z","updated_at":"2025-01-16T18:30:45Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"body":"### What is the documentation issue?\n\nIt is unclear whether `redirect`, `permanentRedirect`, and `notFound` can be called from `generateMetadata`.\n\n* [permanentRedirect](https://nextjs.org/docs/app/api-reference/functions/permanentRedirect): “permanentRedirect can be used in Server Components, Client Components, [Route Handlers](https://nextjs.org/docs/app/api-reference/file-conventions/route), and [Server Actions](https://nextjs.org/docs/app/getting-started/updating-data)”. No mention of `generateMetadata` so it sounds like it is prohibited.\n* [redirect](https://nextjs.org/docs/app/api-reference/functions/redirect): “redirect can be used in [Server Components](https://nextjs.org/docs/app/getting-started/server-and-client-components), [Route Handlers](https://nextjs.org/docs/app/api-reference/file-conventions/route), and [Server Actions](https://nextjs.org/docs/app/getting-started/updating-data).” No mention of `generateMetadata` so it sounds like it is prohibited. Also does not include Client Components although there is an example of client component below.\n* [notFound](https://nextjs.org/docs/app/api-reference/functions/not-found) just says to use it “within a route segment”; does not say specifically where.\n* [generateMetadata](https://nextjs.org/docs/app/api-reference/functions/generate-metadata) says “The [redirect()](https://nextjs.org/docs/app/api-reference/functions/redirect) and [notFound()](https://nextjs.org/docs/app/api-reference/functions/not-found) Next.js methods can also be used inside generateMetadata.”, contradicting the `redirect` documentation. Also no mention of `permanentRedirect`.\n\nI tested a basic page.tsx:\n\n```\nimport { redirect } from \"next/navigation\";\nimport type { Metadata } from 'next';\n\nexport async function generateMetadata(): Promise<Metadata> {\n    await new Promise(resolve => setTimeout(resolve, 1000))\n    redirect('/generate-metadata-redirect');\n}\n\nexport default async function Page() {\n    await new Promise(resolve => setTimeout(resolve, 2000))\n    redirect('/server-component-redirect');\n}\n```\n\nIn nextjs 14, it seems that the first redirect wins, and the redirect from generateMetadata is used. On the other hand, in nextjs 15, it seems that the Server Component redirect always wins.\n\nOn the other hand, if the Server Component does not throw a redirect:\n\n```\nimport { redirect } from \"next/navigation\";\nimport type { Metadata } from 'next';\n\nexport async function generateMetadata(): Promise<Metadata> {\n    await new Promise(resolve => setTimeout(resolve, 1000))\n    redirect('/generate-metadata-redirect');\n}\n\nexport default async function Page() {\n    await new Promise(resolve => setTimeout(resolve, 2000))\n    return (\n        <div>\n            <h1>My Path Page</h1>\n        </div>\n    );\n}\n```\n\nThen nextjs 14 returns the 307 redirect from `generateMetadata`, but nextjs 15 returns status code 200 but then performs a redirect using javascript. The source code of the page contains the stack trace:\n\n```\n<template data-dgst=\"NEXT_REDIRECT;replace;/generate-metadata-redirect;307;\" data-msg=\"Switched to client rendering because the server rendering errored:\n\nNEXT_REDIRECT\" data-stck=\"Switched to client rendering because the server rendering errored:\n\nError: NEXT_REDIRECT\n    at Module.generateMetadata (webpack-internal:///(rsc)/./app/mypath/page.tsx:13:62)\n    at resolveErrorDev (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:44590)\n    at getOutlinedModel (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:32934)\n    at /Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:36809\n    at ResponseInstance._fromJSON (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:37621)\n    at JSON.parse (&lt;anonymous&gt;)\n    at initializeModelChunk (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:25635)\n    at resolveModelChunk (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:25007)\n    at /Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:57533\n    at /Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:57638\n    at progress (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:186:57690)\" data-cstck=\"\n    at MetadataOutlet (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/metadata/async-metadata.js:24:11)\n    at Suspense (&lt;anonymous&gt;)\n    at AsyncMetadataOutlet (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/metadata/async-metadata.js:38:11)\n    at StreamingMetadataOutlet [Server] (&lt;anonymous&gt;)\n    at __next_outlet_boundary__ (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/metadata/metadata-boundary.js:36:15)\n    at InnerLayoutRouter (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:243:11)\n    at RedirectErrorBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/redirect-boundary.js:74:9)\n    at RedirectBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/redirect-boundary.js:82:11)\n    at HTTPAccessFallbackBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/http-access-fallback/error-boundary.js:96:11)\n    at LoadingBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:324:11)\n    at ErrorBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/error-boundary.js:175:11)\n    at InnerScrollAndFocusHandler (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:140:9)\n    at ScrollAndFocusHandler (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:225:11)\n    at RenderFromTemplateContext (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/render-from-template-context.js:16:44)\n    at OuterLayoutRouter (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:360:11)\n    at InnerLayoutRouter (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:243:11)\n    at RedirectErrorBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/redirect-boundary.js:74:9)\n    at RedirectBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/redirect-boundary.js:82:11)\n    at HTTPAccessFallbackErrorBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/http-access-fallback/error-boundary.js:88:9)\n    at HTTPAccessFallbackBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/http-access-fallback/error-boundary.js:96:11)\n    at LoadingBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:324:11)\n    at ErrorBoundary (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/error-boundary.js:175:11)\n    at InnerScrollAndFocusHandler (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:140:9)\n    at ScrollAndFocusHandler (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:225:11)\n    at RenderFromTemplateContext (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/render-from-template-context.js:16:44)\n    at OuterLayoutRouter (webpack-internal:///(ssr)/./node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js:360:11)\n    at body (&lt;anonymous&gt;)\n    at html (&lt;anonymous&gt;)\n    at RootLayout [Server] (&lt;anonymous&gt;)\n    at RedirectErrorBoundary (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:248:4631)\n    at RedirectBoundary (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:248:4727)\n    at AppDevOverlayErrorBoundary (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:274:11584)\n    at AppDevOverlay (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:274:215362)\n    at HotReload (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:274:219791)\n    at Router (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:248:7783)\n    at ErrorBoundaryHandler (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:254:2994)\n    at ErrorBoundary (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:254:4291)\n    at AppRouter (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:248:14186)\n    at ServerInsertedHTMLProvider (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:418:461)\n    at ServerInsertedMetadataProvider (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:422:2243)\n    at App (/Users/yonran/Documents/tutorials/nextjs-redirects/nextjs-dashboard/node_modules/.pnpm/next@15.3.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:422:12743)\"></template><!--/$-->\n```\n\nI think the documentation should be clarified to say whether `redirect`, `permanentRedirect`, and `notFound` can or should be called from `generateMetadata`.\n\n### Is there any context that might help us understand?\n\nNo context.\n\n### Does the docs page already exist? Please link to it.\n\nhttps://nextjs.org/docs/app/api-reference/functions/redirect","reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/80879/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/80879/timeline","performed_via_github_app":null,"state_reason":null,"score":1.0}
