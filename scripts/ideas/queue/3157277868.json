{"url":"https://api.github.com/repos/vercel/next.js/issues/80663","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/80663/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/80663/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/80663/events","html_url":"https://github.com/vercel/next.js/issues/80663","id":3157277868,"node_id":"I_kwDOBC3Cis68MDys","number":80663,"title":"Large `__NEXT_PRIVATE_STANDALONE_CONFIG` causes `Error: spawn E2BIG`","user":{"login":"hdodov","id":5570098,"node_id":"MDQ6VXNlcjU1NzAwOTg=","avatar_url":"https://avatars.githubusercontent.com/u/5570098?v=4","gravatar_id":"","url":"https://api.github.com/users/hdodov","html_url":"https://github.com/hdodov","followers_url":"https://api.github.com/users/hdodov/followers","following_url":"https://api.github.com/users/hdodov/following{/other_user}","gists_url":"https://api.github.com/users/hdodov/gists{/gist_id}","starred_url":"https://api.github.com/users/hdodov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hdodov/subscriptions","organizations_url":"https://api.github.com/users/hdodov/orgs","repos_url":"https://api.github.com/users/hdodov/repos","events_url":"https://api.github.com/users/hdodov/events{/privacy}","received_events_url":"https://api.github.com/users/hdodov/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3499651836,"node_id":"LA_kwDOBC3Cis7QmHL8","url":"https://api.github.com/repos/vercel/next.js/labels/Output","name":"Output","color":"31A7C3","default":false,"description":"Related to the the output configuration option."}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-06-18T15:15:28Z","updated_at":"2025-06-18T15:15:45Z","closed_at":null,"author_association":"CONTRIBUTOR","type":{"id":1930995,"node_id":"IT_kwDOAOSnPM4AHXbz","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T15:36:35Z","updated_at":"2024-07-26T10:33:22Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"body":"### Link to the code that reproduces this issue\n\nhttps://github.com/hdodov/test-nextjs/tree/bug-env-too-large\n\n### To Reproduce\n\n1. Import a large JSON file in your `next.config.js` (e.g. to use as redirects)\n2. Add some code that has to spawn a child process with the `child_process` module\n3. Run Next with `output: \"standalone\"` and in prod mode\n4. Run the app so that it runs the child process code\n5. You'll see this error:\n    \n    ```\n     ⨯ Error: spawn E2BIG\n        at d (.next/server/app/page.js:1:2287)\n        at l (.next/server/app/page.js:1:2358) {\n      errno: -7,\n      code: 'E2BIG',\n      syscall: 'spawn',\n      digest: '1763947400'\n    }\n    ```\n\nWhen logging `process.env`, you can see that basically **the entire JSON file is put in an environment variable**:\n\n<img width=\"1424\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/fcf400f1-5583-4639-b288-e303932c3245\" />\n\nThat's what causes the `E2BIG` error, which happens when a process is spawned with either too long arguments or a too large set of environment variables.\n\n### Current vs. Expected behavior\n\nCurrently, you get a warning in dev mode, if you have too many redirects:\n\n```\n$ pnpm dev                            \n\n> test-nextjs@0.1.0 dev /Users/hristiyan.dodov/Projects/test-nextjs\n> next dev\n\n   ▲ Next.js 15.3.3\n   - Local:        http://localhost:3000\n   - Network:      http://192.168.1.129:3000\n\n ✓ Starting...\nWarning: total number of custom routes exceeds 1000, this can reduce performance. Route counts:\nheaders: 0\nrewrites: 0\nredirects: 2500\nSee more info: https://nextjs.org/docs/messages/max-custom-routes-reached\n ✓ Ready in 2.5s\n```\n\nWhat I'm expecting is to also see a warning that **an environment variable will hold ALL OF THEM as JSON**.\n\nFor my case, the performance impact was negligible and it wasn't a problem. But the fact that we had **~0.5MB in environment variables** surely was.\n\n### Provide environment information\n\n```bash\nOperating System:\n  Platform: darwin\n  Arch: x64\n  Version: Darwin Kernel Version 23.6.0: Thu Apr 24 20:26:36 PDT 2025; root:xnu-10063.141.1.705.2~1/RELEASE_X86_64\n  Available memory (MB): 32768\n  Available CPU cores: 16\nBinaries:\n  Node: 20.17.0\n  npm: 10.8.2\n  Yarn: N/A\n  pnpm: 10.4.1\nRelevant Packages:\n  next: 15.3.3 // Latest available version is detected (15.3.3).\n  eslint-config-next: 15.3.3\n  react: 19.1.0\n  react-dom: 19.1.0\n  typescript: 5.8.3\nNext.js Config:\n  output: standalone\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nOutput\n\n### Which stage(s) are affected? (Select all that apply)\n\nnext start (local)\n\n### Additional context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/80663/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/80663/timeline","performed_via_github_app":null,"state_reason":null,"score":1.0}
